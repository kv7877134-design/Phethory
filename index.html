<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Тест Камеры и Микрофона</title>
    <style>
        /* Стили для центрирования видео и улучшения вида на мобильных */
        body {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            margin: 0;
            background-color: #1a1a1a;
            color: white;
            font-family: Arial, sans-serif;
        }
        #video-container {
            width: 100%;
            max-width: 600px;
            margin: 20px;
            text-align: center;
        }
        #camera-feed {
            /* Видео элемент, куда будет выводиться поток с камеры */
            width: 100%;
            height: auto;
            border-radius: 10px;
            box-shadow: 0 0 15px rgba(0, 0, 0, 0.5);
            /* Отражение для фронтальной камеры */
            transform: scaleX(-1);
        }
        #status {
            margin-top: 20px;
            font-weight: bold;
            color: #4CAF50;
        }
    </style>
</head>
<body>

    <div id="video-container">
        <h2>Ваша Камера</h2>
        <video id="camera-feed" autoplay playsinline></video>
        <p id="status">Ожидание запроса разрешений...</p>
    </div>

    <script>
        // Получаем ссылки на HTML-элементы
        const videoElement = document.getElementById('camera-feed');
        const statusElement = document.getElementById('status');

        // Конфигурация для запроса
        const constraints = {
            // Запрашиваем доступ к видео (камере) и аудио (микрофону)
            video: {
                // Пытаемся получить фронтальную (пользовательскую) камеру
                facingMode: 'user' 
            },
            audio: true
        };

        // Функция для запроса доступа и запуска камеры
        async function startCamera() {
            // Проверяем, поддерживает ли браузер нужный API
            if (!navigator.mediaDevices || !navigator.mediaDevices.getUserMedia) {
                statusElement.textContent = '❌ Ошибка: Ваш браузер не поддерживает MediaDevices API.';
                statusElement.style.color = '#f44336';
                return;
            }

            try {
                // Вызываем API для запроса доступа
                statusElement.textContent = '⏳ Запрос разрешений...';
                
                const stream = await navigator.mediaDevices.getUserMedia(constraints);
                
                // Если доступ получен:
                statusElement.textContent = '✅ Разрешения получены! Фронтальная камера активна.';
                statusElement.style.color = '#4CAF50';
                
                // Привязываем полученный поток к видео-элементу
                videoElement.srcObject = stream;
                
            } catch (err) {
                // Если доступ отклонен или возникла ошибка (например, камера занята)
                statusElement.textContent = `❌ Ошибка доступа: ${err.name} - ${err.message}`;
                statusElement.style.color = '#f44336';
                console.error('Ошибка при доступе к медиа-устройствам:', err);
                
                // Если не удалось получить фронтальную, попробуем запросить любую доступную
                if (err.name === 'NotReadableError' || err.name === 'OverconstrainedError') {
                    // Перезапускаем без facingMode, чтобы использовать любую камеру
                    statusElement.textContent += ' Попытка запроса любой камеры...';
                    tryAnyCamera();
                }
            }
        }
        
        // Функция для попытки запроса любой доступной камеры
        async function tryAnyCamera() {
            try {
                const stream = await navigator.mediaDevices.getUserMedia({ video: true, audio: true });
                statusElement.textContent = '✅ Разрешения получены! Камера активна.';
                statusElement.style.color = '#FFA500'; // Желтый для "любая камера"
                videoElement.srcObject = stream;
            } catch (err) {
                statusElement.textContent = `❌ Ошибка доступа: ${err.name} - ${err.message}`;
                statusElement.style.color = '#f44336';
                console.error('Ошибка при попытке получить любую камеру:', err);
            }
        }

        // Запускаем процесс при загрузке страницы
        startCamera();
        
    </script>

</body>
</html>
